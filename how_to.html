<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to reproduce and extend this work &#8212; Robot Rainfall Rescue</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css?v=34905f61" />
    <script src="_static/documentation_options.js?v=d45e8c67"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authors and acknowledgements" href="credits.html" />
    <link rel="prev" title="Robot Rainfall Rescue" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="credits.html" title="Authors and acknowledgements"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="Robot Rainfall Rescue"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RRR</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">How to reproduce and extend this work</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="how-to-reproduce-and-extend-this-work">
<h1>How to reproduce and extend this work<a class="headerlink" href="#how-to-reproduce-and-extend-this-work" title="Link to this heading">¶</a></h1>
<p>This project is designed to be easy to reproduce and extend. Everything involved is kept under version control in a <a class="reference external" href="https://en.wikipedia.org/wiki/Git">git repository</a>. The repository is hosted on <a class="reference external" href="https://github.com/">GitHub</a> (and the documentation made with <a class="reference external" href="https://pages.github.com/">GitHub Pages</a>). The repository is <a class="reference external" href="https://github.com/philip-brohan/Robot_Rainfall_Rescue">https://github.com/philip-brohan/Robot_Rainfall_Rescue</a>. This repository contains everything you need to reproduce or extend this work.</p>
<p>If you are familiar with GitHub, you already know what to do (fork or clone <a class="reference external" href="https://github.com/philip-brohan/Robot_Rainfall_Rescue">the repository</a>): If you’d prefer not to bother with that, you can download the whole thing as <a class="reference external" href="https://github.com/philip-brohan/Robot_Rainfall_Rescue/archive/master.zip">a zip file</a>.</p>
<p>As well as downloading the software, some setup is necessary to run it successfully:</p>
<p>These scripts will only work in a <a class="reference external" href="https://www.python.org/">python</a> environment with the appropriate python version and libraries available. I use <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a> to manage the required python environment - which is specified in a yaml file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">rrr</span><span class="o">-</span><span class="n">spice</span>
<span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span>
<span class="n">dependencies</span><span class="p">:</span>
<span class="c1"># Basics</span>
  <span class="o">-</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span>
  <span class="o">-</span> <span class="n">matplotlib</span><span class="o">=</span><span class="mf">3.10</span>
  <span class="o">-</span> <span class="n">black</span>  <span class="c1"># Code formatter</span>
  <span class="o">-</span> <span class="n">sphinx</span>  <span class="c1"># Documentation</span>
<span class="c1"># Huggingface transformers library</span>
  <span class="o">-</span> <span class="n">huggingface_hub</span><span class="o">&gt;=</span><span class="mf">0.33</span>
  <span class="o">-</span> <span class="n">transformers</span><span class="o">&gt;=</span><span class="mf">4.51.3</span>
<span class="c1">#  - diffusers&gt;=0.35.0</span>
  
<span class="c1"># Download images from Google Drive</span>
  <span class="o">-</span> <span class="n">rclone</span><span class="o">=</span><span class="mf">1.69</span>

<span class="c1"># Azure</span>
  <span class="o">-</span> <span class="n">marshmallow</span><span class="o">=</span><span class="mf">3.26</span>  <span class="c1"># V4 breaks azure login</span>
  <span class="o">-</span> <span class="n">azure</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">ml</span> <span class="o">=</span> <span class="mf">1.23</span>
  <span class="o">-</span> <span class="n">azure</span><span class="o">-</span><span class="n">identity</span> <span class="o">=</span> <span class="mf">1.21</span>
  <span class="o">-</span> <span class="n">azure</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">datalake</span> <span class="o">=</span> <span class="mf">12.19</span>
  <span class="o">-</span> <span class="n">azure</span><span class="o">-</span><span class="n">keyvault</span> <span class="o">=</span> <span class="mf">4.3</span>

<span class="c1"># Torch backend for transformers</span>
  <span class="o">-</span> <span class="n">pip</span>
  <span class="o">-</span> <span class="n">pip</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">torch</span><span class="o">&gt;=</span><span class="mf">2.4.0</span>
      <span class="o">-</span> <span class="n">torchvision</span>
      <span class="o">-</span> <span class="n">hf_xet</span>
      <span class="o">-</span> <span class="n">accelerate</span><span class="o">==</span><span class="mf">1.4.0</span>
      <span class="o">-</span> <span class="n">compressed</span><span class="o">-</span><span class="n">tensors</span>
      <span class="o">-</span> <span class="n">evaluate</span><span class="o">==</span><span class="mf">0.4.3</span>
      <span class="o">-</span> <span class="n">bitsandbytes</span><span class="o">&gt;=</span><span class="mf">0.45.3</span>
      <span class="o">-</span> <span class="n">trl</span><span class="o">==</span><span class="mf">0.15.2</span>
      <span class="o">-</span> <span class="n">peft</span><span class="o">&gt;=</span><span class="mf">0.15.0</span>
      <span class="o">-</span> <span class="n">pillow</span><span class="o">==</span><span class="mf">11.1.0</span>
      <span class="o">-</span> <span class="n">protobuf</span>
      <span class="o">-</span> <span class="n">sentencepiece</span>
      <span class="o">-</span> <span class="n">flash</span><span class="o">-</span><span class="n">attention</span>
      <span class="o">-</span> <span class="n">datasets</span><span class="o">==</span><span class="mf">3.3.2</span>
      <span class="o">-</span> <span class="n">tensorboardX</span>
      <span class="o">-</span> <span class="n">tensorboard</span>
      <span class="o">-</span> <span class="n">opencensus</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">logging</span>
      <span class="o">-</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">huggingface</span><span class="o">/</span><span class="n">diffusers</span>
     

<span class="n">variables</span><span class="p">:</span>
<span class="c1"># Tell python to look for modules in the root directory of the project</span>
<span class="c1"># (A hack, needs to be edited for every installation, but makes code</span>
<span class="c1">#  management much easier.)</span>
<span class="c1"># Replace with the path to your project directory root.</span>
  <span class="n">PYTHONPATH</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">philip</span><span class="o">.</span><span class="n">brohan</span><span class="o">/</span><span class="n">Projects</span><span class="o">/</span><span class="n">Robot_Rainfall_Rescue</span>

<span class="c1"># Project data path</span>
  <span class="n">PDIR</span><span class="p">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">philip</span><span class="o">.</span><span class="n">brohan</span><span class="o">/</span><span class="n">Robot_Rainfall_Rescue</span>

<span class="c1"># Tell huggingface where to store model weights</span>
  <span class="n">HF_HOME</span><span class="p">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">philip</span><span class="o">.</span><span class="n">brohan</span><span class="o">/</span><span class="n">huggingface</span>

<span class="c1"># Azure ML subscription, workspace and resource group</span>
  <span class="n">AZML_SUBSCRIPTION_ID</span><span class="p">:</span> <span class="mi">79</span><span class="n">c7890c</span><span class="o">-</span><span class="mi">2</span><span class="n">a30</span><span class="o">-</span><span class="mi">44</span><span class="n">ef</span><span class="o">-</span><span class="n">aa8d</span><span class="o">-</span><span class="mi">419</span><span class="n">d25b7bb8e</span>
  <span class="n">AZML_WORKSPACE_NAME</span><span class="p">:</span> <span class="n">mlw</span><span class="o">-</span><span class="n">llmdatarescue</span><span class="o">-</span><span class="n">uksouth</span><span class="o">-</span><span class="mi">01</span>
  <span class="n">AZML_RESOURCE_GROUP</span><span class="p">:</span> <span class="n">rg</span><span class="o">-</span><span class="n">climate</span><span class="o">-</span><span class="n">llmdatarescue</span>
</pre></div>
</div>
<p>As always with ML work, you will need access to a GPU. I use a dedicated <a class="reference external" href="https://learn.microsoft.com/en-us/azure/machine-learning/concept-workspace?view=azureml-api-2">MS Azure ML workspace</a> for this, so the code in this repository contains some scripts and configuration files specific to that. But the actual training and analysis code is not specific to Azure, and should work in any suitable python environment with access to a GPU (I used 80Gb H100s, mostly; 60Gb A100s will do instead. I have not tested any of this on smaller GPUs). All the scripts here will run on a single 60Gb A100.</p>
<p>The project documentation (these web pages) are included in the repository (in the <a class="reference external" href="https://github.com/philip-brohan/Robot_Rainfall_rescue/tree/master/docs">docs directory</a>). The documentation is in <a class="reference external" href="https://en.wikipedia.org/wiki/ReStructuredText">reStructuredText</a> format, and uses the <a class="reference external" href="https://docs.readthedocs.io/en/stable/intro/getting-started-with-sphinx.html">Sphinx</a> documentation generator.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/RRR_logo.png" alt="Logo of Robot Rainfall Rescue"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to reproduce or extend this work</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Authors and acknowledgements</a></li>
</ul>
<h3><a href="https://github.com/philip-brohan/Robot_Rainfall_Rescue">Get the code</a></h3>

<ul>
<li><a href="https://github.com/philip-brohan/Robot_Rainfall_Rescue"
           rel="nofollow">Github repository</a></li>
<li><a href="https://github.com/philip-brohan/Robot_Rainfall_Rescue/archive/master.zip"
           rel="nofollow">Zip file</a></li>
</ul>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/philip-brohan/Robot_Rainfall_Rescue/issues/new">raise an issue</a><br>or <a href="mailto://philip.brohan@metoffice.gov.uk">contact Philip</a>.
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="credits.html" title="Authors and acknowledgements"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="Robot Rainfall Rescue"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RRR</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">How to reproduce and extend this work</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>